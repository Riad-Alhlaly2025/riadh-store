{% extends 'store/base.html' %}
{% load static %}

{% block title %}جميع المنتجات - متجر رياض الإلكتروني الفاخر{% endblock %}

{% block breadcrumb_items %}
<a href="{% url 'product_list' %}" class="breadcrumb-item active">المنتجات</a>
{% endblock %}

{% block content %}
<div class="grid grid-cols-1 gap-6">
    <!-- Page Header -->
    <div class="luxury-card">
        <div class="luxury-card-body">
            <h1 class="text-3xl font-bold mb-2"><i class="fas fa-store"></i> مجموعة المنتجات الفاخرة</h1>
            <p class="text-secondary">اكتشف أحدث المنتجات المتميزة من متجر رياض الإلكتروني</p>
        </div>
    </div>
    
    <!-- Filters and Search -->
    <div class="luxury-card">
        <div class="luxury-card-header">
            <h3 class="m-0"><i class="fas fa-filter"></i> تصفية المنتجات</h3>
        </div>
        <div class="luxury-card-body">
            <form method="GET" action="{% url 'product_list' %}" class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="form-group md:col-span-2">
                    <label for="search" class="form-label">البحث</label>
                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" id="search" name="q" value="{{ request.GET.q }}" class="search-input" placeholder="ابحث عن منتج...">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="category" class="form-label">التصنيف</label>
                    <select id="category" name="category" class="form-control">
                        <option value="">جميع التصنيفات</option>
                        <option value="electronics" {% if request.GET.category == 'electronics' %}selected{% endif %}>إلكترونيات</option>
                        <option value="fashion" {% if request.GET.category == 'fashion' %}selected{% endif %}>أزياء</option>
                        <option value="home" {% if request.GET.category == 'home' %}selected{% endif %}>منزل ومطبخ</option>
                        <option value="beauty" {% if request.GET.category == 'beauty' %}selected{% endif %}>جمال وعناية</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="min_price" class="form-label">السعر الأدنى</label>
                    <input type="number" id="min_price" name="min_price" value="{{ request.GET.min_price }}" class="form-control" placeholder="0">
                </div>
                
                <div class="form-group">
                    <label for="max_price" class="form-label">السعر الأقصى</label>
                    <input type="number" id="max_price" name="max_price" value="{{ request.GET.max_price }}" class="form-control" placeholder="10000">
                </div>
                
                <div class="md:col-span-4 flex gap-3">
                    <button type="submit" class="btn btn-premium">
                        <i class="fas fa-search"></i> تطبيق
                    </button>
                    <a href="{% url 'product_list' %}" class="btn btn-secondary">
                        <i class="fas fa-redo"></i> إعادة تعيين
                    </a>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Product Grid -->
    <div>
        {% if products %}
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold"><i class="fas fa-box-open"></i> المنتجات المتوفرة</h2>
            <div class="flex items-center gap-2">
                <label for="sort" class="text-secondary">ترتيب حسب:</label>
                <select id="sort" class="form-control" style="width: auto;">
                    <option value="newest">الأحدث</option>
                    <option value="price_low">الأقل سعراً</option>
                    <option value="price_high">الأعلى سعراً</option>
                    <option value="popularity">الأكثر شعبية</option>
                    <option value="rating">الأعلى تقييماً</option>
                </select>
            </div>
        </div>
        
        <div class="product-grid">
            {% for product in products %}
            <div class="product-card">
                <div class="product-badge">فاخر</div>
                <div class="product-image-container">
                    {% if product.image %}
                    <img src="{{ product.image.url }}" 
                         srcset="{{ product.image.url }} 1x, {{ product.image.url }} 2x" 
                         alt="{{ product.name }}" 
                         class="product-image" 
                         loading="lazy">
                    {% else %}
                    <div class="product-image bg-surface-light flex items-center justify-center">
                        <i class="fas fa-camera text-3xl text-secondary"></i>
                    </div>
                    {% endif %}
                </div>
                <div class="product-body">
                    <h3 class="product-title">{{ product.name }}</h3>
                    <p class="product-description">{{ product.description|truncatewords:15 }}</p>
                    <div class="product-meta">
                        <div class="product-rating">
                            <i class="fas fa-star star"></i>
                            <i class="fas fa-star star"></i>
                            <i class="fas fa-star star"></i>
                            <i class="fas fa-star star"></i>
                            <i class="fas fa-star star"></i>
                            <span class="text-secondary text-sm">(128)</span>
                        </div>
                        <div class="product-price">{{ product.price }} ر.س</div>
                    </div>
                    <div class="flex gap-2 mt-4">
                        <a href="{% url 'product_detail' product.pk %}" class="btn btn-primary flex-1">
                            <i class="fas fa-eye"></i> عرض
                        </a>
                        <form method="post" action="{% url 'add_to_cart' product.pk %}" class="add-to-cart-form flex-1">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-secondary w-full">
                                <i class="fas fa-shopping-cart"></i> إضافة
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Pagination -->
        <div class="mt-8 text-center">
            <ul class="inline-flex items-center gap-2">
                <li>
                    <a href="#" class="btn btn-secondary">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </li>
                <li>
                    <a href="#" class="btn btn-premium">1</a>
                </li>
                <li>
                    <a href="#" class="btn btn-secondary">2</a>
                </li>
                <li>
                    <a href="#" class="btn btn-secondary">3</a>
                </li>
                <li>
                    <a href="#" class="btn btn-secondary">4</a>
                </li>
                <li>
                    <a href="#" class="btn btn-secondary">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
            </ul>
        </div>
        {% else %}
        <div class="luxury-card text-center py-12">
            <div>
                <i class="fas fa-box-open text-5xl text-secondary mb-4"></i>
                <h3 class="text-2xl font-bold mb-2">لا توجد منتجات متوفرة</h3>
                <p class="text-secondary mb-6">لم يتم العثور على منتجات تطابق معايير البحث الخاصة بك</p>
                <a href="{% url 'product_list' %}" class="btn btn-primary">
                    <i class="fas fa-redo"></i> إعادة تعيين البحث
                </a>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add to cart functionality
    const addToCartForms = document.querySelectorAll('.add-to-cart-form');
    addToCartForms.forEach(form => {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const productId = this.action.match(/\/cart\/add\/(\d+)\//)[1];
            
            fetch(this.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Update cart count in header
                    const cartCount = document.querySelector('.cart-count');
                    if (cartCount) {
                        const currentCount = parseInt(cartCount.textContent) || 0;
                        cartCount.textContent = currentCount + 1;
                    }
                    
                    // Show success message
                    alert('تمت إضافة المنتج إلى السلة بنجاح!');
                } else {
                    alert('حدث خطأ أثناء إضافة المنتج إلى السلة');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('حدث خطأ أثناء إضافة المنتج إلى السلة');
            });
        });
    });
    
    // Sort functionality
    const sortSelect = document.getElementById('sort');
    if (sortSelect) {
        sortSelect.addEventListener('change', function() {
            // In a real implementation, this would trigger a new search with sorting parameters
            alert('سيتم تطبيق الترتيب المحدد');
        });
    }
    
    // Search suggestions functionality
    const searchInput = document.getElementById('search');
    if (searchInput) {
        searchInput.addEventListener('focus', function() {
            // In a real implementation, this would fetch search suggestions
            console.log('Search input focused');
        });
    }
});
</script>
{% endblock %}