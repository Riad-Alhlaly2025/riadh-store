{% extends 'store/base.html' %}
{% load static %}

{% block title %}قائمة المفضلة - متجر رياض الإلكتروني الفاخر{% endblock %}

{% block content %}
<div class="luxury-dashboard">
    <!-- Wishlist Header -->
    <div class="dashboard-header luxury-card animated fadeInDown">
        <div class="header-content">
            <div class="user-greeting">
                <h1 class="welcome-title"><i class="fas fa-heart"></i> قائمة المفضلة الفاخرة</h1>
                <p class="last-login">منتجات مختارة بعناية من مجموعة متجر رياض الإلكتروني</p>
            </div>
            <div class="header-stats">
                <div class="stat-badge">
                    <i class="fas fa-heart"></i>
                    <span class="stat-label">المنتجات المفضلة</span>
                    <span class="stat-value">{{ wishlist_items|length }}</span>
                </div>
                <div class="stat-badge">
                    <i class="fas fa-tags"></i>
                    <span class="stat-label">القيمة الإجمالية</span>
                    <span class="stat-value">{{ total_value }} ر.س</span>
                </div>
            </div>
        </div>
    </div>
    
    {% if wishlist_items %}
    <div class="wishlist-section">
        <div class="wishlist-items luxury-card animated fadeInUp">
            <div class="wishlist-header">
                <h3><i class="fas fa-list"></i> المنتجات المفضلة</h3>
            </div>
            <div class="wishlist-content">
                {% for item in wishlist_items %}
                <div class="wishlist-item luxury-item animated fadeInUp" data-delay="{{ forloop.counter0|div:10 }}">
                    <div class="item-image luxury-image">
                        {% if item.product.image %}
                        <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}">
                        {% else %}
                        <div class="no-image">
                            <i class="fas fa-camera"></i>
                        </div>
                        {% endif %}
                    </div>
                    <div class="item-details luxury-details">
                        <h4>{{ item.product.name }}</h4>
                        <p class="item-description">{{ item.product.description|truncatewords:15 }}</p>
                        <div class="item-meta">
                            <div class="item-rating luxury-rating">
                                <i class="fas fa-star filled"></i>
                                <i class="fas fa-star filled"></i>
                                <i class="fas fa-star filled"></i>
                                <i class="fas fa-star filled"></i>
                                <i class="fas fa-star filled"></i>
                                <span class="rating-count">(128)</span>
                            </div>
                            <div class="item-price luxury-price">{{ item.product.price }} ر.س</div>
                        </div>
                    </div>
                    <div class="item-actions luxury-actions">
                        <a href="{% url 'product_detail' item.product.pk %}" class="luxury-btn primary">
                            <i class="fas fa-eye"></i> عرض التفاصيل
                        </a>
                        <form method="post" action="{% url 'add_to_cart' item.product.pk %}" class="add-to-cart-form">
                            {% csrf_token %}
                            <button type="submit" class="luxury-btn secondary">
                                <i class="fas fa-shopping-cart"></i> إضافة للسلة
                            </button>
                        </form>
                        <button class="luxury-btn danger remove-item" data-item-id="{{ item.id }}">
                            <i class="fas fa-trash"></i> إزالة
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <!-- Wishlist Actions -->
        <div class="wishlist-actions luxury-card animated fadeInUp">
            <div class="actions-header">
                <h3><i class="fas fa-cogs"></i> إجراءات على القائمة</h3>
            </div>
            <div class="actions-content">
                <div class="action-buttons luxury-buttons">
                    <button class="luxury-btn primary full-width" id="moveAllToCart">
                        <i class="fas fa-shopping-cart"></i> نقل الكل إلى السلة
                    </button>
                    <button class="luxury-btn secondary full-width" id="shareWishlist">
                        <i class="fas fa-share-alt"></i> مشاركة القائمة
                    </button>
                    <button class="luxury-btn danger full-width" id="clearWishlist">
                        <i class="fas fa-trash"></i> مسح القائمة
                    </button>
                </div>
                
                <!-- Luxury Promotions -->
                <div class="luxury-promotions">
                    <div class="promotion-item luxury-promo">
                        <div class="promo-icon">
                            <i class="fas fa-gift"></i>
                        </div>
                        <div class="promo-content">
                            <h5>خصومات حصرية</h5>
                            <p>على المنتجات في قائمة المفضلة</p>
                        </div>
                    </div>
                    
                    <div class="promotion-item luxury-promo">
                        <div class="promo-icon">
                            <i class="fas fa-bell"></i>
                        </div>
                        <div class="promo-content">
                            <h5>تنبيهات الأسعار</h5>
                            <p>نبّهني عند انخفاض الأسعار</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Recommended Products -->
    <div class="recommended-products luxury-card animated fadeInUp">
        <div class="recommended-header">
            <h3><i class="fas fa-star"></i> منتجات قد تعجبك</h3>
        </div>
        <div class="recommended-content">
            <div class="product-grid">
                <!-- Recommended products would be displayed here -->
                <div class="product-card luxury-card">
                    <div class="product-img">
                        <img src="{% static 'images/placeholder.png' %}" alt="منتج مقترح">
                    </div>
                    <div class="product-info">
                        <h3>iPhone 15 Pro</h3>
                        <p class="price">5,200 ر.س</p>
                        <a href="#" class="luxury-btn secondary">عرض التفاصيل</a>
                    </div>
                </div>
                
                <div class="product-card luxury-card">
                    <div class="product-img">
                        <img src="{% static 'images/placeholder.png' %}" alt="منتج مقترح">
                    </div>
                    <div class="product-info">
                        <h3>MacBook Air M2</h3>
                        <p class="price">7,500 ر.س</p>
                        <a href="#" class="luxury-btn secondary">عرض التفاصيل</a>
                    </div>
                </div>
                
                <div class="product-card luxury-card">
                    <div class="product-img">
                        <img src="{% static 'images/placeholder.png' %}" alt="منتج مقترح">
                    </div>
                    <div class="product-info">
                        <h3>AirPods Pro</h3>
                        <p class="price">900 ر.س</p>
                        <a href="#" class="luxury-btn secondary">عرض التفاصيل</a>
                    </div>
                </div>
                
                <div class="product-card luxury-card">
                    <div class="product-img">
                        <img src="{% static 'images/placeholder.png' %}" alt="منتج مقترح">
                    </div>
                    <div class="product-info">
                        <h3>Apple Watch Series 9</h3>
                        <p class="price">2,100 ر.س</p>
                        <a href="#" class="luxury-btn secondary">عرض التفاصيل</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="empty-wishlist luxury-card animated fadeInUp">
        <div class="empty-wishlist-content">
            <i class="fas fa-heart empty-wishlist-icon"></i>
            <h3>قائمة المفضلة فارغة</h3>
            <p>لا توجد منتجات في قائمة المفضلة الخاصة بك</p>
            <a href="{% url 'product_list' %}" class="luxury-btn primary">
                <i class="fas fa-store"></i> تصفح المنتجات
            </a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add to cart functionality
    const addToCartForms = document.querySelectorAll('.add-to-cart-form');
    addToCartForms.forEach(form => {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            
            fetch(this.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Update cart count in header
                    const cartCount = document.querySelector('.cart-count');
                    if (cartCount) {
                        const currentCount = parseInt(cartCount.textContent) || 0;
                        cartCount.textContent = currentCount + 1;
                    }
                    
                    // Show success message
                    alert('تمت إضافة المنتج إلى السلة بنجاح!');
                } else {
                    alert('حدث خطأ أثناء إضافة المنتج إلى السلة');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('حدث خطأ أثناء إضافة المنتج إلى السلة');
            });
        });
    });
    
    // Remove item functionality
    const removeButtons = document.querySelectorAll('.remove-item');
    removeButtons.forEach(button => {
        button.addEventListener('click', function() {
            const itemId = this.dataset.itemId;
            
            if (confirm('هل أنت متأكد من إزالة هذا المنتج من قائمة المفضلة؟')) {
                fetch(`/wishlist/remove/${itemId}/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('حدث خطأ أثناء إزالة المنتج');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('حدث خطأ أثناء إزالة المنتج');
                });
            }
        });
    });
    
    // Move all to cart
    const moveAllToCartBtn = document.getElementById('moveAllToCart');
    if (moveAllToCartBtn) {
        moveAllToCartBtn.addEventListener('click', function() {
            if (confirm('هل أنت متأكد من نقل جميع المنتجات إلى السلة؟')) {
                fetch('/wishlist/move-all-to-cart/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('حدث خطأ أثناء نقل المنتجات إلى السلة');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('حدث خطأ أثناء نقل المنتجات إلى السلة');
                });
            }
        });
    }
    
    // Clear wishlist
    const clearWishlistBtn = document.getElementById('clearWishlist');
    if (clearWishlistBtn) {
        clearWishlistBtn.addEventListener('click', function() {
            if (confirm('هل أنت متأكد من مسح قائمة المفضلة بالكامل؟')) {
                fetch('/wishlist/clear/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('حدث خطأ أثناء مسح قائمة المفضلة');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('حدث خطأ أثناء مسح قائمة المفضلة');
                });
            }
        });
    }
    
    // Share wishlist
    const shareWishlistBtn = document.getElementById('shareWishlist');
    if (shareWishlistBtn) {
        shareWishlistBtn.addEventListener('click', function() {
            // In a real implementation, this would generate a shareable link
            alert('سيتم إنشاء رابط قابل للمشاركة لقائمة المفضلة الخاصة بك');
        });
    }
    
    // Add staggered animations
    const animatedElements = document.querySelectorAll('.animated');
    animatedElements.forEach((el, index) => {
        const delay = el.dataset.delay || 0;
        setTimeout(() => {
            el.style.opacity = 1;
            el.style.transform = 'translateY(0)';
        }, parseFloat(delay) * 1000 || 0);
    });
});
</script>
{% endblock %}