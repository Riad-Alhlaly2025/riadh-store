{% extends 'store/base.html' %}
{% load static %}

{% block title %}{{ product.name }} - متجر رياض الإلكتروني الفاخر{% endblock %}

{% block meta_description %}{{ product.description|truncatewords:30 }} - تجربة تسوق فاخرة من متجر رياض الإلكتروني{% endblock %}

{% block content %}
<div class="grid grid-cols-1 gap-6">
    <!-- Product Header -->
    <div class="luxury-card">
        <div class="luxury-card-body">
            <div class="flex justify-between items-start">
                <div>
                    <h1 class="text-3xl font-bold mb-2">{{ product.name }}</h1>
                    <p class="text-secondary">منتج مميز من مجموعة متجر رياض الإلكتروني الفاخر</p>
                </div>
                <div class="flex gap-3">
                    <div class="bg-surface-light px-3 py-1 rounded-full text-sm">
                        <i class="fas fa-medal"></i>
                        <span class="stat-value gold">ممتاز</span>
                    </div>
                    <div class="bg-surface-light px-3 py-1 rounded-full text-sm">
                        <i class="fas fa-shield-alt"></i>
                        <span class="stat-value success">2 سنة ضمان</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Product Images Gallery -->
        <div class="luxury-card">
            <div class="luxury-card-body">
                <h3 class="text-xl font-bold mb-4"><i class="fas fa-images"></i> معرض الصور</h3>
                <div class="gallery-content">
                    {% if product.image %}
                    <div class="main-image-container bg-surface-light rounded-xl overflow-hidden mb-4">
                        <img src="{{ product.image.url }}" class="w-full h-96 object-contain" alt="{{ product.name }}">
                    </div>
                    <div class="thumbnail-gallery flex gap-2">
                        <div class="thumbnail active border-2 border-accent rounded-lg p-1">
                            <img src="{{ product.image.url }}" alt="{{ product.name }}" class="w-16 h-16 object-cover rounded">
                        </div>
                        <!-- Additional thumbnails would go here -->
                    </div>
                    {% else %}
                    <div class="no-image-placeholder luxury-card text-center py-12">
                        <i class="fas fa-camera text-4xl text-secondary mb-3"></i>
                        <p class="text-secondary">لا توجد صورة</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Product Information -->
        <div class="luxury-card">
            <div class="luxury-card-body">
                <div class="info-header mb-6">
                    <h2 class="text-2xl font-bold mb-3">{{ product.name }}</h2>
                    <div class="product-rating flex items-center gap-2 mb-4">
                        <div class="rating-display flex">
                            <i class="fas fa-star star"></i>
                            <i class="fas fa-star star"></i>
                            <i class="fas fa-star star"></i>
                            <i class="fas fa-star star"></i>
                            <i class="fas fa-star star"></i>
                        </div>
                        <span class="text-secondary">4.9 (128 تقييم)</span>
                    </div>
                </div>
                
                <div class="product-price-section mb-6">
                    <p class="product-price text-3xl font-bold text-accent">{{ product.price }} 
                        {% if product.currency == 'USD' %}USD
                        {% elif product.currency == 'EUR' %}EUR
                        {% elif product.currency == 'SAR' %}ر.س
                        {% elif product.currency == 'AED' %}د.إ
                        {% elif product.currency == 'EGP' %}ج.م
                        {% elif product.currency == 'KWD' %}د.ك
                        {% elif product.currency == 'QAR' %}ر.ق
                        {% elif product.currency == 'OMR' %}ر.ع.
                        {% elif product.currency == 'BHD' %}د.ب
                        {% elif product.currency == 'JOD' %}د.أ
                        {% else %}{{ product.currency }}
                        {% endif %}
                    </p>
                    <div class="price-badge bg-gold text-primary px-3 py-1 rounded-full text-sm inline-flex items-center gap-1 mt-2">
                        <i class="fas fa-crown"></i>
                        <span>سعر خاص</span>
                    </div>
                </div>
                
                <div class="product-description mb-6">
                    <h4 class="text-lg font-bold mb-3"><i class="fas fa-info-circle"></i> الوصف</h4>
                    <p class="text-secondary">{{ product.description }}</p>
                </div>
                
                <div class="product-features mb-6">
                    <h4 class="text-lg font-bold mb-3"><i class="fas fa-list"></i> المميزات</h4>
                    <ul class="grid grid-cols-1 md:grid-cols-2 gap-2">
                        <li class="flex items-center gap-2"><i class="fas fa-check-circle text-success"></i> ضمان لمدة سنتين</li>
                        <li class="flex items-center gap-2"><i class="fas fa-check-circle text-success"></i> شحن مجاني</li>
                        <li class="flex items-center gap-2"><i class="fas fa-check-circle text-success"></i> إرجاع خلال 30 يوم</li>
                        <li class="flex items-center gap-2"><i class="fas fa-check-circle text-success"></i> دعم فني على مدار الساعة</li>
                    </ul>
                </div>
                
                <div class="product-actions">
                    {% if product.in_stock %}
                    <div class="stock-status bg-success/20 text-success px-3 py-2 rounded-lg mb-4 flex items-center gap-2">
                        <i class="fas fa-check-circle"></i>
                        <span>متوفر في المخزون ({{ product.stock_quantity }} وحدة)</span>
                    </div>
                    {% elif product.is_low_stock %}
                    <div class="stock-status bg-warning/20 text-warning px-3 py-2 rounded-lg mb-4 flex items-center gap-2">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>عدد قليل في المخزون ({{ product.stock_quantity }} وحدة)</span>
                    </div>
                    {% else %}
                    <div class="stock-status bg-error/20 text-error px-3 py-2 rounded-lg mb-4 flex items-center gap-2">
                        <i class="fas fa-times-circle"></i>
                        <span>غير متوفر حالياً</span>
                    </div>
                    {% endif %}
                    
                    {% if product.in_stock %}
                    <form method="post" action="{% url 'add_to_cart' product.pk %}" class="add-to-cart-form mb-3">
                        {% csrf_token %}
                        <div class="quantity-selector mb-4">
                            <label for="quantity" class="block mb-2 font-medium">الكمية:</label>
                            <div class="quantity-control flex items-center gap-2">
                                <button type="button" class="btn btn-secondary quantity-btn minus">-</button>
                                <input type="number" id="quantity" name="quantity" value="1" min="1" max="{{ product.stock_quantity }}" class="form-control text-center w-20">
                                <button type="button" class="btn btn-secondary quantity-btn plus">+</button>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary w-full add-to-cart-btn">
                            <i class="fas fa-shopping-cart"></i> إضافة للسلة
                        </button>
                    </form>
                    {% endif %}
                    
                    <button class="btn btn-outline w-full">
                        <i class="fas fa-heart"></i> إضافة إلى المفضلة
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Product Specifications -->
    <div class="luxury-card">
        <div class="luxury-card-body">
            <h3 class="text-xl font-bold mb-4"><i class="fas fa-clipboard-list"></i> المواصفات الفنية</h3>
            <div class="specifications-content">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="spec-row flex justify-between py-3 border-b border-border">
                        <div class="spec-label font-medium">العلامة التجارية</div>
                        <div class="spec-value">Apple</div>
                    </div>
                    <div class="spec-row flex justify-between py-3 border-b border-border">
                        <div class="spec-label font-medium">الطراز</div>
                        <div class="spec-value">iPhone 15 Pro</div>
                    </div>
                    <div class="spec-row flex justify-between py-3 border-b border-border">
                        <div class="spec-label font-medium">الذاكرة</div>
                        <div class="spec-value">256GB</div>
                    </div>
                    <div class="spec-row flex justify-between py-3 border-b border-border">
                        <div class="spec-label font-medium">اللون</div>
                        <div class="spec-value">رمادي فضي</div>
                    </div>
                    <div class="spec-row flex justify-between py-3 border-b border-border">
                        <div class="spec-label font-medium">الضمان</div>
                        <div class="spec-value">2 سنة</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Social Sharing -->
    <div class="luxury-card">
        <div class="luxury-card-body">
            <h3 class="text-xl font-bold mb-4"><i class="fas fa-share-alt"></i> مشاركة المنتج</h3>
            <div class="sharing-content">
                <div class="social-buttons flex gap-3">
                    <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}" target="_blank" class="btn btn-secondary">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}&text={{ product.name }}" target="_blank" class="btn btn-secondary">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ request.build_absolute_uri }}&title={{ product.name }}" target="_blank" class="btn btn-secondary">
                        <i class="fab fa-linkedin-in"></i>
                    </a>
                    <a href="https://wa.me/?text={{ request.build_absolute_uri }}" target="_blank" class="btn btn-secondary">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Quantity selector functionality
    const minusBtn = document.querySelector('.quantity-btn.minus');
    const plusBtn = document.querySelector('.quantity-btn.plus');
    const quantityInput = document.getElementById('quantity');
    
    if (minusBtn && plusBtn && quantityInput) {
        minusBtn.addEventListener('click', function() {
            let value = parseInt(quantityInput.value);
            if (value > 1) {
                quantityInput.value = value - 1;
            }
        });
        
        plusBtn.addEventListener('click', function() {
            let value = parseInt(quantityInput.value);
            let max = parseInt(quantityInput.max);
            if (value < max) {
                quantityInput.value = value + 1;
            }
        });
    }
    
    // Add to cart functionality
    const addToCartForm = document.querySelector('.add-to-cart-form');
    if (addToCartForm) {
        addToCartForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            
            fetch(this.action, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Update cart count in header
                    const cartCount = document.querySelector('.cart-count');
                    if (cartCount) {
                        // Recalculate total cart count
                        let totalCount = 0;
                        const cartItems = document.querySelectorAll('.cart-item');
                        cartItems.forEach(item => {
                            const quantity = parseInt(item.querySelector('.quantity-input').value);
                            totalCount += quantity;
                        });
                        cartCount.textContent = totalCount;
                    }
                    
                    // Show success message
                    alert(data.message || 'تمت إضافة المنتج إلى السلة بنجاح!');
                    
                    // Optionally redirect to cart page
                    // window.location.href = '/cart/';
                } else {
                    alert(data.message || 'حدث خطأ أثناء إضافة المنتج إلى السلة');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('حدث خطأ أثناء إضافة المنتج إلى السلة');
            });
        });
    }
});
</script>
{% endblock %}