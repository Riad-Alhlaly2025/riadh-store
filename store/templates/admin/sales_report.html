{% extends "admin/custom_base.html" %}
{% load static %}

{% block title %}ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª{% endblock %}

{% block content %}
<div class="dashboard-container">
    <h1>ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h1>
    
    <!-- Sales Statistics -->
    <div class="dashboard-stats">
        <div class="stat-card">
            <div class="stat-icon">ğŸ“Š</div>
            <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
            <div class="stat-number">{{ total_orders }}</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">ğŸ’°</div>
            <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</h3>
            <div class="stat-number">{{ total_revenue|floatformat:2 }} Ø±.Ø³</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">ğŸ“¦</div>
            <h3>Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨</h3>
            <div class="stat-number">{{ total_revenue|divisibleby:total_orders|floatformat:2 }} Ø±.Ø³</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">ğŸ“ˆ</div>
            <h3>Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ù…Ùˆ</h3>
            <div class="stat-number">+12.5%</div>
        </div>
    </div>
    
    <!-- Sales Trends Chart -->
    <div class="chart-container">
        <h3>Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ù„Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>
        <canvas id="salesTrendsChart" height="100"></canvas>
    </div>
    
    <!-- Sales by Status -->
    <div class="chart-container">
        <h3>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©</h3>
        <canvas id="salesByStatusChart" height="100"></canvas>
    </div>
    
    <!-- Sales by Payment Method -->
    <div class="chart-container">
        <h3>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø­Ø³Ø¨ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</h3>
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>
                        <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</th>
                        <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ÙŠÙ…Ø©</th>
                        <th>Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</th>
                    </tr>
                </thead>
                <tbody>
                    {% for payment in sales_by_payment %}
                    <tr>
                        <td>
                            {% if payment.payment_method == 'stripe' %}Stripe
                            {% elif payment.payment_method == 'paypal' %}PayPal
                            {% else %}{{ payment.payment_method }}
                            {% endif %}
                        </td>
                        <td>{{ payment.count }}</td>
                        <td>{{ payment.total|floatformat:2 }} Ø±.Ø³</td>
                        <td>
                            {% if total_revenue %}
                            {{ payment.total|divisibleby:total_revenue|mul:100|floatformat:1 }}%
                            {% else %}0%{% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Top Selling Products -->
    <div class="chart-container">
        <h3>Ø£ÙƒØ«Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¨ÙŠØ¹Ø§Ù‹</h3>
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                        <th>Ø§Ù„ÙØ¦Ø©</th>
                        <th>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©</th>
                        <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in top_products %}
                    <tr>
                        <td>{{ product.name }}</td>
                        <td>
                            {% if product.category == 'phones' %}Ù‡ÙˆØ§ØªÙ
                            {% elif product.category == 'computers' %}Ø£Ø¬Ù‡Ø²Ø© ÙƒÙ…Ø¨ÙŠÙˆØªØ±
                            {% elif product.category == 'accessories' %}Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª
                            {% else %}ØºÙŠØ± Ù…ØµÙ†Ù
                            {% endif %}
                        </td>
                        <td>{{ product.total_sold|default:0 }}</td>
                        <td>{{ product.total_revenue|default:0|floatformat:2 }} Ø±.Ø³</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¨Ø§Ø¹Ø©</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Export Options -->
    <div class="chart-container">
        <h3>ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h3>
        <div style="display: flex; gap: 15px;">
            <button class="btn-custom" onclick="exportReport('pdf')">ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ PDF</button>
            <button class="btn-custom btn-success" onclick="exportReport('excel')">ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel</button>
            <button class="btn-custom btn-warning" onclick="exportReport('csv')">ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ CSV</button>
        </div>
    </div>
</div>

<script>
    // Parse sales trends data
    var salesTrendsData = JSON.parse('{{ sales_trends|escapejs }}');
    
    // Prepare sales by status data
    var salesByStatusLabels = [];
    var salesByStatusData = [];
    var salesByStatusColors = [];
    
    // Sample data for sales by status
    salesByStatusLabels = ['Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±', 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©', 'ØªÙ… Ø§Ù„Ø´Ø­Ù†', 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…', 'Ù…Ù„ØºÙ‰'];
    salesByStatusData = [15, 25, 30, 45, 5];
    salesByStatusColors = ['#FFD700', '#1E90FF', '#32CD32', '#20B2AA', '#FF6347'];
    
    document.addEventListener('DOMContentLoaded', function() {
        // Sales Trends Chart
        var ctx1 = document.getElementById('salesTrendsChart').getContext('2d');
        var salesTrendsChart = new Chart(ctx1, {
            type: 'line',
            data: {
                labels: salesTrendsData.map(item => {
                    var date = new Date(item.day);
                    return date.toLocaleDateString('ar-SA', { day: 'numeric', month: 'short' });
                }),
                datasets: [{
                    label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª',
                    data: salesTrendsData.map(item => item.count),
                    borderColor: '#0074D9',
                    backgroundColor: 'rgba(0, 116, 217, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    yAxisID: 'y'
                }, {
                    label: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ÙŠÙ…',
                    data: salesTrendsData.map(item => item.total),
                    borderColor: '#2ECC40',
                    backgroundColor: 'rgba(46, 204, 64, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    yAxisID: 'y1'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª'
                        }
                    },
                    y1: {
                        beginAtZero: true,
                        position: 'right',
                        title: {
                            display: true,
                            text: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ÙŠÙ… (Ø±.Ø³)'
                        },
                        grid: {
                            drawOnChartArea: false,
                        },
                    }
                }
            }
        });
        
        // Sales by Status Chart
        var ctx2 = document.getElementById('salesByStatusChart').getContext('2d');
        var salesByStatusChart = new Chart(ctx2, {
            type: 'bar',
            data: {
                labels: salesByStatusLabels,
                datasets: [{
                    label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª',
                    data: salesByStatusData,
                    backgroundColor: salesByStatusColors,
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª'
                        }
                    }
                }
            }
        });
    });
    
    function exportReport(format) {
        alert('Ø³ÙŠØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ØªÙ†Ø³ÙŠÙ‚ ' + format + '. Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ø³ØªÙƒÙˆÙ† Ù…ØªØ§Ø­Ø© ÙÙŠ Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„ÙƒØ§Ù…Ù„.');
    }
</script>
{% endblock %}